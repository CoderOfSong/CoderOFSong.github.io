---
layout: post
title: "Git | Git命令"
date: 2019-02-21 
description: "Git命令"
tag: Git 
---   

## Git | Git命令

-----

## 一、版本库

------------

### 1、创建版本库

什么是版本库？版本库又名仓库，英文名repository，你可以简单的理解一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的修改，删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻还可以将文件”还原”。

所以创建一个版本库也非常简单，如下我是`C盘 -> git_repository`下新建一个test版本库。

通过命令 `git init` 把这个目录变成git可以管理的仓库，如下： 

![1创建版本库1.png](https://i.imgur.com/Smp7xEH.png)

这时候你当前test目录下会多了一个.git的目录，这个目录是Git来跟踪管理版本的，没事千万不要手动乱改这个目录里面的文件，否则，会把git仓库给破坏了。如下：

![1创建版本库2.png](https://i.imgur.com/Pkkz9at.png)

--------

### 2、把文件添加到版本库中

首先要明确下，所有的版本控制系统，只能跟踪文本文件的改动，比如txt文件，网页，所有程序的代码等，Git也不列外，版本控制系统可以告诉你每次的改动，但是图片，视频这些二进制文件，虽能也能由版本控制系统管理，但没法跟踪文件的变化，只能把二进制文件每次改动串起来，也就是知道图片从1kb变成2kb，但是到底改了啥，版本控制也不知道。

下面先看下demo如下演示：

我在版本库test目录下新建一个记事本文件 test.txt 内容如下：11111111

第一步：使用命令 `git add test.txt` 添加到暂存区里面去。如下：

![2添加文件1.png](https://i.imgur.com/HnFo7dl.png)

如果和上面一样，没有任何提示，说明已经添加成功了。

第二步：用命令 `git commit` 告诉Git，把文件提交到仓库。

![2添加文件2.png](https://i.imgur.com/5p1gjSA.png)

现在我们已经提交了一个test.txt文件了，我们下面可以通过命令 `git status` 来查看是否还有文件未提交，如下：

![2添加文件3.png](https://i.imgur.com/KzKLr0K.png)

说明没有任何文件未提交，但是我现在继续来改下test.txt内容，比如我在下面添加一行2222222222内容，继续使用 `git status` 来查看下结果，如下： 

![2添加文件4.png](https://i.imgur.com/aEDxkFr.png)

上面的命令告诉我们 test.txt文件已被修改，但是未被提交的修改。

接下来我想看下test.txt文件到底改了什么内容，如何查看呢？可以使用命令：`git diff readme.txt` 如下：

![2添加文件5.png](https://i.imgur.com/0BQCbr8.png)

如上可以看到，readme.txt文件内容从一行11111111改成 二行 添加了一行22222222内容。

知道了对readme.txt文件做了什么修改后，我们可以放心的提交到仓库了，提交修改和提交文件是一样的2步(第一步是 `git add` 第二步是： `git commit`)。如下：

![2添加文件6.png](https://i.imgur.com/diWbUrG.png)

-------------------

### 3、版本回退

如上，我们已经学会了修改文件，现在我继续对readme.txt文件进行修改，再增加一行内容为33333333333333继续执行命令如下：

![3版本回退1.png](https://i.imgur.com/yl1bnHz.png)

现在我已经对readme.txt文件做了三次修改了，那么我现在想查看下历史记录，如何查呢？我们现在可以使用命令 `git log` 演示如下所示：

![3版本回退2.png](https://i.imgur.com/39A7zPL.png) 

git log命令显示从最近到最远的显示日志，我们可以看到最近三次提交，最近的一次是,增加内容为333333.上一次是添加内容222222，第一次默认是 111111.如果嫌上面显示的信息太多的话，我们可以使用命令 `git log –pretty=oneline` 演示如下： 

![3版本回退3.png](https://i.imgur.com/5lJNSPE.png)

现在我想使用版本回退操作，我想把当前的版本回退到上一个版本，要使用什么命令呢？可以使用如下2种命令。
第一种是：`git reset --hard HEAD^` 那么如果要回退到上上个版本只需把 `HEAD^` 改成 `HEAD^^` 以此类推。那如果要回退到前100个版本的话，使用上面的方法肯定不方便，我们可以使用下面的简便命令操作：`git reset --hard HEAD~100` 即可。未回退之前的readme.txt内容如下： 

![3版本回退4.png](https://i.imgur.com/x0uEU9n.png)

如果想回退到上一个版本的命令如下操作： 

![3版本回退5.png](https://i.imgur.com/pxWlwZP.png)

再来查看下 readme.txt内容如下：通过命令 `cat readme.txt` 查看 

![3版本回退6.png](https://i.imgur.com/vrDqHI9.png)

可以看到，内容已经回退到上一个版本了。我们可以继续使用 `git log` 来查看下历史记录信息，如下： 

![3版本回退7.png](https://i.imgur.com/Mcwl0we.png)

我们看到 增加333333 内容我们没有看到了，但是现在我想回退到最新的版本，如：有333333的内容要如何恢复呢？我们可以通过版本号回退，使用命令方法如下：

`git reset --hard 版本号` ，但是现在的问题假如我已经关掉过一次命令行或者333内容的版本号我并不知道呢？要如何知道增加3333内容的版本号呢？可以通过如下命令即可获取到版本号：`git reflog` 演示如下：

![3版本回退8.png](https://i.imgur.com/1d7bjP0.png)

通过上面的显示我们可以知道，增加内容3333的版本号是 eb2d2a7。我们现在可以命令 `git reset --hard eb2d2a7` 来恢复了。演示如下：

![3版本回退9.png](https://i.imgur.com/Wqs7Djp.png)

![3版本回退10.png](https://i.imgur.com/ObxlNKS.png)

------------

## 二、工作区和暂存区

### 1、工作区和暂存区

**工作区：**就是你在电脑上看到的目录，比如目录下testgit里的文件(.git隐藏目录版本库除外)。或者以后需要再新建的目录文件等等都属于工作区范畴。

**版本库(Repository)：**工作区有一个隐藏目录.git,这个不属于工作区，这是版本库。其中版本库里面存了很多东西，其中最重要的就是stage(暂存区)，还有Git为我们自动创建了第一个分支master,以及指向master的一个指针HEAD。

我们前面说过使用Git提交文件到版本库有两步：

第一步：是使用 `git add` 把文件添加进去，实际上就是把文件添加到暂存区。

第二步：使用 `git commit` 提交更改，实际上就是把暂存区的所有内容提交到当前分支上。

我们继续使用demo来演示下：

我们在readme.txt再添加一行内容为4444444，接着在目录下新建一个文件为test.txt 内容为test，我们先用命令 `git status` 来查看下状态，如下：

![4工作暂存区1.png](https://i.imgur.com/Nb5rfvc.png)

现在我们先使用 `git add` 命令把2个文件都添加到暂存区中，再使用 `git status` 来查看下状态，如下： 

![4工作暂存区2.png](https://i.imgur.com/zAVxOuA.png)

接着我们可以使用 `git commit` 一次性提交到分支上，如下： 

![4工作暂存区3.png](https://i.imgur.com/POkKhAO.png)

------------

## 三、Git撤销修改和删除文件操作

### 1、撤销修改








------------

## 总结

### 1、新建代码库

    # 在当前目录新建一个Git代码库
    $ git init
    
    # 新建一个目录，将其初始化为Git代码库
    $ git init [project-name]
    
    # 下载一个项目和它的整个代码历史
    $ git clone [url]

### 2、配置

    # 显示当前的Git配置
    $ git config --list
    
    # 编辑Git配置文件
    $ git config -e [--global]
    
    # 设置提交代码时的用户信息
    $ git config [--global] user.name "[name]"
    $ git config [--global] user.email "[email address]"

### 3、增加/删除文件

    # 添加指定文件到暂存区
    $ git add [file1] [file2] ...
    
    # 添加指定目录到暂存区，包括子目录
    $ git add [dir]
    
    # 添加当前目录的所有文件到暂存区
    $ git add .
    
    # 添加每个变化前，都会要求确认
    # 对于同一个文件的多处变化，可以实现分次提交
    $ git add -p
    
    # 删除工作区文件，并且将这次删除放入暂存区
    $ git rm [file1] [file2] ...
    
    # 停止追踪指定文件，但该文件会保留在工作区
    $ git rm --cached [file]
    
    # 改名文件，并且将这个改名放入暂存区
    $ git mv [file-original] [file-renamed]

### 4、代码提交

    # 提交暂存区到仓库区
    $ git commit -m [message]
    
    # 提交暂存区的指定文件到仓库区
    $ git commit [file1] [file2] ... -m [message]
    
    # 提交工作区自上次commit之后的变化，直接到仓库区
    $ git commit -a
    
    # 提交时显示所有diff信息
    $ git commit -v
    
    # 使用一次新的commit，替代上一次提交
    # 如果代码没有任何新变化，则用来改写上一次commit的提交信息
    $ git commit --amend -m [message]
    
    # 重做上一次commit，并包括指定文件的新变化
    $ git commit --amend [file1] [file2] ...

### 5、分支

    # 列出所有本地分支
    $ git branch
    
    # 列出所有远程分支
    $ git branch -r
    
    # 列出所有本地分支和远程分支
    $ git branch -a
    
    # 新建一个分支，但依然停留在当前分支
    $ git branch [branch-name]
    
    # 新建一个分支，并切换到该分支
    $ git checkout -b [branch]
    
    # 新建一个分支，指向指定commit
    $ git branch [branch] [commit]
    
    # 新建一个分支，与指定的远程分支建立追踪关系
    $ git branch --track [branch] [remote-branch]
    
    # 切换到指定分支，并更新工作区
    $ git checkout [branch-name]
    
    # 切换到上一个分支
    $ git checkout -
    
    # 建立追踪关系，在现有分支与指定的远程分支之间
    $ git branch --set-upstream [branch] [remote-branch]
    
    # 合并指定分支到当前分支
    $ git merge [branch]
    
    # 选择一个commit，合并进当前分支
    $ git cherry-pick [commit]
    
    # 删除分支
    $ git branch -d [branch-name]
    
    # 删除远程分支
    $ git push origin --delete [branch-name]
    $ git branch -dr [remote/branch]

### 6、标签

    # 列出所有tag
    $ git tag
    
    # 新建一个tag在当前commit
    $ git tag [tag]
    
    # 新建一个tag在指定commit
    $ git tag [tag] [commit]
    
    # 删除本地tag
    $ git tag -d [tag]
    
    # 删除远程tag
    $ git push origin :refs/tags/[tagName]
    
    # 查看tag信息
    $ git show [tag]
    
    # 提交指定tag
    $ git push [remote] [tag]
    
    # 提交所有tag
    $ git push [remote] --tags
    
    # 新建一个分支，指向某个tag
    $ git checkout -b [branch] [tag]

### 7、查看信息

    # 显示有变更的文件
    $ git status
    
    # 显示当前分支的版本历史
    $ git log
    
    # 显示commit历史，以及每次commit发生变更的文件
    $ git log --stat
    
    # 搜索提交历史，根据关键词
    $ git log -S [keyword]
    
    # 显示某个commit之后的所有变动，每个commit占据一行
    $ git log [tag] HEAD --pretty=format:%s
    
    # 显示某个commit之后的所有变动，其"提交说明"必须符合搜索条件
    $ git log [tag] HEAD --grep feature
    
    # 显示某个文件的版本历史，包括文件改名
    $ git log --follow [file]
    $ git whatchanged [file]
    
    # 显示指定文件相关的每一次diff
    $ git log -p [file]
    
    # 显示过去5次提交
    $ git log -5 --pretty --oneline
    
    # 显示所有提交过的用户，按提交次数排序
    $ git shortlog -sn
    
    # 显示指定文件是什么人在什么时间修改过
    $ git blame [file]
    
    # 显示暂存区和工作区的差异
    $ git diff
    
    # 显示暂存区和上一个commit的差异
    $ git diff --cached [file]
    
    # 显示工作区与当前分支最新commit之间的差异
    $ git diff HEAD
    
    # 显示两次提交之间的差异
    $ git diff [first-branch]...[second-branch]
    
    # 显示今天你写了多少行代码
    $ git diff --shortstat "@{0 day ago}"
    
    # 显示某次提交的元数据和内容变化
    $ git show [commit]
    
    # 显示某次提交发生变化的文件
    $ git show --name-only [commit]
    
    # 显示某次提交时，某个文件的内容
    $ git show [commit]:[filename]
    
    # 显示当前分支的最近几次提交
    $ git reflog

### 8、远程同步

    # 下载远程仓库的所有变动
    $ git fetch [remote]
    
    # 显示所有远程仓库
    $ git remote -v
    
    # 显示某个远程仓库的信息
    $ git remote show [remote]
    
    # 增加一个新的远程仓库，并命名
    $ git remote add [shortname] [url]
    
    # 取回远程仓库的变化，并与本地分支合并
    $ git pull [remote] [branch]
    
    # 上传本地指定分支到远程仓库
    $ git push [remote] [branch]
    
    # 强行推送当前分支到远程仓库，即使有冲突
    $ git push [remote] --force
    
    # 推送所有分支到远程仓库
    $ git push [remote] --all

### 9、撤销

    # 恢复暂存区的指定文件到工作区
    $ git checkout [file]
    
    # 恢复某个commit的指定文件到暂存区和工作区
    $ git checkout [commit] [file]
    
    # 恢复暂存区的所有文件到工作区
    $ git checkout .
    
    # 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变
    $ git reset [file]
    
    # 重置暂存区与工作区，与上一次commit保持一致
    $ git reset --hard
    
    # 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变
    $ git reset [commit]
    
    # 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致
    $ git reset --hard [commit]
    
    # 重置当前HEAD为指定commit，但保持暂存区和工作区不变
    $ git reset --keep [commit]
    
    # 新建一个commit，用来撤销指定commit
    # 后者的所有变化都将被前者抵消，并且应用到当前分支
    $ git revert [commit]
    
    # 暂时将未提交的变化移除，稍后再移入
    $ git stash
    $ git stash pop

--------------------------

转载请注明原地址，宋德凌的博客：[http://CoderOfSong.github.io](http://CoderOfSong.github.io) 谢谢！